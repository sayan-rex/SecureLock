#ifndef __REGISTERS_H
#define __REGISTERS_H

#include <stdint.h>

// Base addresses
#define PERIPH_BASE       0x40000000UL
#define APB1PERIPH_BASE   PERIPH_BASE
#define APB2PERIPH_BASE   (PERIPH_BASE + 0x00010000UL)
#define AHB1PERIPH_BASE   (PERIPH_BASE + 0x00020000UL)

// RCC registers
#define RCC_BASE          (AHB1PERIPH_BASE + 0x3800)
#define RCC_CR           *(volatile uint32_t*)(RCC_BASE + 0x00)
#define RCC_PLLCFGR      *(volatile uint32_t*)(RCC_BASE + 0x04)
#define RCC_CFGR         *(volatile uint32_t*)(RCC_BASE + 0x08)
#define RCC_AHB1ENR      *(volatile uint32_t*)(RCC_BASE + 0x30)

// GPIO registers
#define GPIOA_BASE       (AHB1PERIPH_BASE + 0x0000)
#define GPIOB_BASE       (AHB1PERIPH_BASE + 0x0400)
#define GPIOC_BASE       (AHB1PERIPH_BASE + 0x0800)
#define GPIOD_BASE       (AHB1PERIPH_BASE + 0x0C00)

typedef struct {
    volatile uint32_t MODER;
    volatile uint32_t OTYPER;
    volatile uint32_t OSPEEDR;
    volatile uint32_t PUPDR;
    volatile uint32_t IDR;
    volatile uint32_t ODR;
    volatile uint16_t BSRRL;
    volatile uint16_t BSRRH;
    volatile uint32_t LCKR;
    volatile uint32_t AFR[2];
} GPIO_TypeDef;

#define GPIOA           ((GPIO_TypeDef*)GPIOA_BASE)
#define GPIOB           ((GPIO_TypeDef*)GPIOB_BASE)
#define GPIOC           ((GPIO_TypeDef*)GPIOC_BASE)
#define GPIOD           ((GPIO_TypeDef*)GPIOD_BASE)

// I2C registers
#define I2C1_BASE       (APB1PERIPH_BASE + 0x5400)
typedef struct {
    volatile uint32_t CR1;
    volatile uint32_t CR2;
    volatile uint32_t OAR1;
    volatile uint32_t OAR2;
    volatile uint32_t DR;
    volatile uint32_t SR1;
    volatile uint32_t SR2;
    volatile uint32_t CCR;
    volatile uint32_t TRISE;
} I2C_TypeDef;

#define I2C1            ((I2C_TypeDef*)I2C1_BASE)

// USART registers
#define USART2_BASE     (APB1PERIPH_BASE + 0x4400)
typedef struct {
    volatile uint32_t SR;
    volatile uint32_t DR;
    volatile uint32_t BRR;
    volatile uint32_t CR1;
    volatile uint32_t CR2;
    volatile uint32_t CR3;
    volatile uint32_t GTPR;
} USART_TypeDef;

#define USART2          ((USART_TypeDef*)USART2_BASE)

#endif // __REGISTERS_H
